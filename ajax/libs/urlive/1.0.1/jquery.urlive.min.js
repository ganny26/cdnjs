/*
 * jquery.urlive.min.js v1.0.1, jQuery URLive
 *
 * View the plugin repository at:
 * https://github.com/markserbol/urlive
 *
 */

(function(a){var k={container:".urlive-container",target:"_blank",imageSize:"auto",render:!0,disableClick:!1,callbacks:{onStart:function(){},onSuccess:function(){},onFail:function(){},noData:function(){},onLoadEnd:function(){},imgError:function(){}}},l=function(c){var d=RegExp(location.protocol+"//"+location.hostname),a="http"+(/^https/.test(location.protocol)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?";return function(b){var g=b.url;/get/i.test(b.type)&&!/json/i.test(b.dataType)&&!d.test(g)&&/:\/\//.test(g)&&(b.url=a,b.dataType="json",b.data={q:'select * from html where url="{URL}" and xpath="*" and compat="html5"'.replace("{URL}",g+(b.data?(/\?/.test(g)?"&":"?")+jQuery.param(b.data):"")),format:"xml"},!b.success&&b.complete&&(b.success=b.complete,delete b.complete),b.success=function(a){return function(c){a&&a.call(this,{responseText:(c.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"")},"success")}}(b.success));return c.apply(this,arguments)}}(a.ajax),f=function(){var c=a(this).attr("data-urlive-container")||a(this);return a(c).find(".urlive-link")},h={init:function(c){var d=a.extend(!0,k,c);return this.each(function(){function c(a){if(/\.(?:jpe?g|gif|png)/.test(a)){var d=a.substr(a.lastIndexOf("/")+1);g({image:a,title:d,url:a})}else b(a)}function b(c){l({url:c,type:"GET",beforeSend:d.callbacks.onStart}).done(function(b){b=b.results;a.isEmptyObject(b)?d.callbacks.noData():(b=b[0],html=a("<div/>",{html:b}),get=function(a){return html.find('[property="'+a+'"]').attr("content")||html.find('[name="'+a+'"]').attr("content")||html.find(a).html()||html.find(a).attr("src")},set={image:get("og:image")||get("img"),title:get("og:title")||get("title"),url:get("og:url")||c,description:get("og:description"),type:get("og:type"),sitename:get("og:site_name")},d.callbacks.onSuccess(set),d.render&&g(set))}).fail(function(c,b,e){a.error("YQL request error: ",b,e);d.callbacks.onFail()})}function g(c){anchor=a("<a/>",{"class":"urlive-link",href:c.url,target:d.target});imgWrapper=a("<div/>",{"class":"urlive-img-wrapper"});textWrapper=a("<div/>",{"class":"urlive-text-wrapper"});a.each(c,function(c,b){b&&("image"==c?(img=a("<img/>",{src:b}),img.error(d.callbacks.imgError),img.hide().load(function(){var b=a(this).width();a(this).addClass("urlive-"+c).show();"auto"==d.imageSize?b>=anchor.width()?anchor.addClass("urlive-img-large"):(anchor.addClass("urlive-img-small"),textWrapper.outerWidth(anchor.width()-imgWrapper.outerWidth(!0))):"large"==d.imageSize?anchor.addClass("urlive-img-large"):"small"==d.imageSize&&(anchor.addClass("urlive-img-small"),textWrapper.outerWidth(anchor.width()-imgWrapper.outerWidth(!0)));d.callbacks.onLoadEnd()}),img.appendTo(imgWrapper)):(elem=a("<span/>",{"class":"urlive-"+c,text:b}),elem.appendTo(textWrapper)))});anchor.append(imgWrapper).append(textWrapper).appendTo(d.container);if(d.disableClick)anchor.on("click",function(a){a.preventDefault()})}var e=a(this);e.attr("data-urlive-container",d.container);if(e.is("a"))e=e.attr("href"),c(e);else{var e=e.val()||e.text(),f=/((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/i;f.test(e)&&(e=f.exec(e)[0],c(e))}})},close:function(a){f.apply(this).fadeOut(a)},remove:function(a){var d=f.apply(this);a?d.fadeOut(a,function(){d.remove()}):d.remove()},open:function(a){f.apply(this).fadeIn(a)},disable:function(){f.apply(this).on("click",function(a){a.preventDefault()})},enable:function(){f.apply(this).off("click")}};a.fn.urlive=function(c){if(h[c])return h[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof c&&c)a.error('Method "'+c+'" does not exist on jquery.urlive');else return h.init.apply(this,arguments)}})(jQuery);