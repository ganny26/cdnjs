{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js"],"sourcesContent":["export function h(tag, data) {\n  var node\n  var stack = []\n  var children = []\n\n  for (var i = arguments.length; i-- > 2; ) {\n    stack[stack.length] = arguments[i]\n  }\n\n  while (stack.length) {\n    if (Array.isArray((node = stack.pop()))) {\n      for (var i = node.length; i--; ) {\n        stack[stack.length] = node[i]\n      }\n    } else if (node != null && node !== true && node !== false) {\n      if (typeof node === \"number\") {\n        node = node + \"\"\n      }\n      children[children.length] = node\n    }\n  }\n\n  return typeof tag === \"string\"\n    ? {\n        tag: tag,\n        data: data || {},\n        children: children\n      }\n    : tag(data, children)\n}\n","export function app(app) {\n  var state = {}\n  var actions = {}\n  var events = {}\n  var mixins = []\n  var view = app.view\n  var root = app.root || document.body\n  var node\n  var element\n  var locked = false\n  var loaded = false\n\n  for (var i = -1; i < mixins.length; i++) {\n    var mixin = mixins[i] ? mixins[i](emit) : app\n\n    Object.keys(mixin.events || []).map(function(key) {\n      events[key] = (events[key] || []).concat(mixin.events[key])\n    })\n\n    if (mixin.state != null) {\n      state = merge(state, mixin.state)\n    }\n\n    mixins = mixins.concat(mixin.mixins || [])\n\n    initialize(actions, mixin.actions)\n  }\n\n  node = hydrate((element = root.querySelector(\"[data-ssr]\")), [].map)\n\n  repaint(emit(\"init\"))\n\n  return emit\n\n  function repaint() {\n    if (!locked) {\n      requestAnimationFrame(render, (locked = !locked))\n    }\n  }\n\n  function hydrate(element, map) {\n    return element == null\n      ? element\n      : {\n          tag: element.tagName,\n          data: {},\n          children: map.call(element.childNodes, function(element) {\n            hydrate(element, map)\n          })\n        }\n  }\n\n  function render() {\n    element = patch(\n      root,\n      element,\n      node,\n      (node = emit(\"render\", view)(state, actions))\n    )\n\n    locked = !locked\n\n    if (!loaded) {\n      emit(\"loaded\", (loaded = true))\n    }\n  }\n\n  function initialize(namespace, children, lastName) {\n    Object.keys(children || []).map(function(key) {\n      var action = children[key]\n      var name = lastName ? lastName + \".\" + key : key\n\n      if (typeof action === \"function\") {\n        namespace[key] = function(data) {\n          var result = action(\n            state,\n            actions,\n            emit(\"action\", {\n              name: name,\n              data: data\n            }).data\n          )\n\n          if (result != null && result.then == null) {\n            repaint((state = merge(state, emit(\"update\", result))))\n          }\n\n          return result\n        }\n      } else {\n        initialize(namespace[key] || (namespace[key] = {}), action, name)\n      }\n    })\n  }\n\n  function emit(name, data) {\n    ;(events[name] || []).map(function(cb) {\n      var result = cb(state, actions, data)\n      if (result != null) {\n        data = result\n      }\n    })\n\n    return data\n  }\n\n  function merge(a, b) {\n    if (typeof b !== \"object\") {\n      return b\n    }\n\n    var obj = {}\n\n    for (var i in a) {\n      obj[i] = a[i]\n    }\n\n    for (var i in b) {\n      obj[i] = b[i]\n    }\n\n    return obj\n  }\n\n  function createElement(node, isSVG) {\n    if (typeof node === \"string\") {\n      var element = document.createTextNode(node)\n    } else {\n      var element = (isSVG = isSVG || node.tag === \"svg\")\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.tag)\n        : document.createElement(node.tag)\n\n      for (var i = 0; i < node.children.length; ) {\n        element.appendChild(createElement(node.children[i++], isSVG))\n      }\n\n      for (var i in node.data) {\n        if (i === \"oncreate\") {\n          node.data[i](element)\n        } else if (i === \"oninsert\") {\n          setTimeout(node.data[i], 0, element)\n        } else {\n          setElementData(element, i, node.data[i])\n        }\n      }\n    }\n\n    return element\n  }\n\n  function setElementData(element, name, value, oldValue) {\n    if (name === \"key\") {\n    } else if (name === \"style\") {\n      for (var i in merge(oldValue, (value = value || {}))) {\n        element.style[i] = value[i] || \"\"\n      }\n    } else {\n      try {\n        element[name] = value\n      } catch (_) {}\n\n      if (typeof value !== \"function\") {\n        if (value) {\n          element.setAttribute(name, value)\n        } else {\n          element.removeAttribute(name)\n        }\n      }\n    }\n  }\n\n  function updateElementData(element, oldData, data) {\n    for (var name in merge(oldData, data)) {\n      var value = data[name]\n      var oldValue =\n        name === \"value\" || name === \"checked\" ? element[name] : oldData[name]\n\n      if (name === \"onupdate\" && value) {\n        value(element)\n      } else if (value !== oldValue) {\n        setElementData(element, name, value, oldValue)\n      }\n    }\n  }\n\n  function getKey(node) {\n    if (node && (node = node.data)) {\n      return node.key\n    }\n  }\n\n  function removeElement(parent, element, node) {\n    ;((node.data && node.data.onremove) || removeChild)(element, removeChild)\n    function removeChild() {\n      parent.removeChild(element)\n    }\n  }\n\n  function patch(parent, element, oldNode, node) {\n    if (oldNode == null) {\n      element = parent.insertBefore(createElement(node), element)\n    } else if (node.tag && node.tag === oldNode.tag) {\n      updateElementData(element, oldNode.data, node.data)\n\n      var len = node.children.length\n      var oldLen = oldNode.children.length\n      var reusableChildren = {}\n      var oldElements = []\n      var newKeys = {}\n\n      for (var i = 0; i < oldLen; i++) {\n        var oldElement = element.childNodes[i]\n        oldElements[i] = oldElement\n\n        var oldChild = oldNode.children[i]\n        var oldKey = getKey(oldChild)\n\n        if (null != oldKey) {\n          reusableChildren[oldKey] = [oldElement, oldChild]\n        }\n      }\n\n      var i = 0\n      var j = 0\n\n      while (j < len) {\n        var oldElement = oldElements[i]\n        var oldChild = oldNode.children[i]\n        var newChild = node.children[j]\n\n        var oldKey = getKey(oldChild)\n        if (newKeys[oldKey]) {\n          i++\n          continue\n        }\n\n        var newKey = getKey(newChild)\n\n        var reusableChild = reusableChildren[newKey] || []\n\n        if (null == newKey) {\n          if (null == oldKey) {\n            patch(element, oldElement, oldChild, newChild)\n            j++\n          }\n          i++\n        } else {\n          if (oldKey === newKey) {\n            patch(element, reusableChild[0], reusableChild[1], newChild)\n            i++\n          } else if (reusableChild[0]) {\n            element.insertBefore(reusableChild[0], oldElement)\n            patch(element, reusableChild[0], reusableChild[1], newChild)\n          } else {\n            patch(element, oldElement, null, newChild)\n          }\n\n          j++\n          newKeys[newKey] = newChild\n        }\n      }\n\n      while (i < oldLen) {\n        var oldChild = oldNode.children[i]\n        var oldKey = getKey(oldChild)\n        if (null == oldKey) {\n          removeElement(element, oldElements[i], oldChild)\n        }\n        i++\n      }\n\n      for (var i in reusableChildren) {\n        var reusableChild = reusableChildren[i]\n        var reusableNode = reusableChild[1]\n        if (!newKeys[reusableNode.data.key]) {\n          removeElement(element, reusableChild[0], reusableNode)\n        }\n      }\n    } else if (node !== oldNode) {\n      var i = element\n      parent.replaceChild((element = createElement(node)), i)\n    }\n\n    return element\n  }\n}\n"],"names":["tag","data","node","stack","children","i","arguments","length","Array","isArray","pop","app","repaint","locked","requestAnimationFrame","render","hydrate","element","map","tagName","call","childNodes","patch","root","emit","view","state","actions","loaded","initialize","namespace","lastName","Object","keys","key","action","name","result","then","merge","events","cb","a","b","obj","createElement","isSVG","document","createTextNode","createElementNS","appendChild","setTimeout","setElementData","value","oldValue","style","_","setAttribute","removeAttribute","updateElementData","oldData","getKey","removeElement","parent","removeChild","onremove","oldNode","insertBefore","len","oldLen","reusableChildren","oldElements","newKeys","oldElement","oldKey","oldChild","j","newChild","newKey","reusableChild","reusableNode","replaceChild","mixins","body","mixin","concat","querySelector"],"mappings":"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"}