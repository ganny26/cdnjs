{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js"],"sourcesContent":["export function h(tag, data) {\n  var node\n  var stack = []\n  var children = []\n\n  for (var i = arguments.length; i-- > 2; ) {\n    stack[stack.length] = arguments[i]\n  }\n\n  while (stack.length) {\n    if (Array.isArray((node = stack.pop()))) {\n      for (var i = node.length; i--; ) {\n        stack[stack.length] = node[i]\n      }\n    } else if (node != null && node !== true && node !== false) {\n      if (typeof node === \"number\") {\n        node = node + \"\"\n      }\n      children[children.length] = node\n    }\n  }\n\n  return typeof tag === \"string\"\n    ? {\n        tag: tag,\n        data: data || {},\n        children: children\n      }\n    : tag(data, children)\n}\n","export function app(app) {\n  var state = {}\n  var actions = {}\n  var events = {}\n  var mixins = []\n  var view = app.view\n  var root = app.root || document.body\n  var node\n  var element\n  var locked = false\n  var loaded = false\n\n  for (var i = -1; i < mixins.length; i++) {\n    var mixin = mixins[i] ? mixins[i](emit) : app\n\n    Object.keys(mixin.events || []).map(function(key) {\n      events[key] = (events[key] || []).concat(mixin.events[key])\n    })\n\n    if (mixin.state != null) {\n      state = merge(state, mixin.state)\n    }\n\n    mixins = mixins.concat(mixin.mixins || [])\n\n    initialize(actions, mixin.actions)\n  }\n\n  node = hydrate((element = root.querySelector(\"[data-ssr]\")), [].map)\n\n  repaint(emit(\"init\"))\n\n  return emit\n\n  function repaint() {\n    if (!locked) {\n      requestAnimationFrame(render, (locked = !locked))\n    }\n  }\n\n  function hydrate(element, map) {\n    return element == null\n      ? element\n      : {\n          tag: element.tagName,\n          data: {},\n          children: map.call(element.childNodes, function(element) {\n            hydrate(element, map)\n          })\n        }\n  }\n\n  function render() {\n    element = patch(\n      root,\n      element,\n      node,\n      (node = emit(\"render\", view)(state, actions))\n    )\n\n    locked = !locked\n\n    if (!loaded) {\n      emit(\"loaded\", (loaded = true))\n    }\n  }\n\n  function initialize(namespace, children, lastName) {\n    Object.keys(children || []).map(function(key) {\n      var action = children[key]\n      var name = lastName ? lastName + \".\" + key : key\n\n      if (typeof action === \"function\") {\n        namespace[key] = function(data) {\n          var result = action(\n            state,\n            actions,\n            emit(\"action\", {\n              name: name,\n              data: data\n            }).data\n          )\n\n          if (result != null && result.then == null) {\n            repaint((state = merge(state, emit(\"update\", result))))\n          }\n\n          return result\n        }\n      } else {\n        initialize(namespace[key] || (namespace[key] = {}), action, name)\n      }\n    })\n  }\n\n  function emit(name, data) {\n    return (events[name] || []).map(function(cb) {\n      var result = cb(state, actions, data)\n      if (result != null) {\n        data = result\n      }\n    }), data\n  }\n\n  function merge(a, b) {\n    if (typeof b !== \"object\") {\n      return b\n    }\n\n    var obj = {}\n\n    for (var i in a) {\n      obj[i] = a[i]\n    }\n\n    for (var i in b) {\n      obj[i] = b[i]\n    }\n\n    return obj\n  }\n\n  function getKey(node) {\n    if (node && (node = node.data)) {\n      return node.key\n    }\n  }\n\n  function createElement(node, isSVG) {\n    if (typeof node === \"string\") {\n      var element = document.createTextNode(node)\n    } else {\n      var element = (isSVG = isSVG || node.tag === \"svg\")\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.tag)\n        : document.createElement(node.tag)\n\n      for (var i = 0; i < node.children.length; ) {\n        element.appendChild(createElement(node.children[i++], isSVG))\n      }\n\n      for (var i in node.data) {\n        if (i === \"oncreate\") {\n          node.data[i](element)\n        } else if (i === \"oninsert\") {\n          setTimeout(node.data[i], 0, element)\n        } else {\n          setElementData(element, i, node.data[i])\n        }\n      }\n    }\n\n    return element\n  }\n\n  function setElementData(element, name, value, oldValue) {\n    if (\n      name === \"key\" ||\n      name === \"oncreate\" ||\n      name === \"oninsert\" ||\n      name === \"onupdate\" ||\n      name === \"onremove\"\n    ) {\n      return name\n    } else if (name === \"style\") {\n      for (var i in merge(oldValue, (value = value || {}))) {\n        element.style[i] = value[i] || \"\"\n      }\n    } else {\n      try {\n        element[name] = value\n      } catch (_) {}\n\n      if (typeof value !== \"function\") {\n        if (value) {\n          element.setAttribute(name, value)\n        } else {\n          element.removeAttribute(name)\n        }\n      }\n    }\n  }\n\n  function updateElementData(element, oldData, data, cb) {\n    for (var name in merge(oldData, data)) {\n      var value = data[name]\n      var oldValue = oldData[name]\n\n      if (\n        value !== oldValue &&\n        value !== element[name] &&\n        setElementData(element, name, value, oldValue) == null\n      ) {\n        cb = data.onupdate\n      }\n    }\n\n    if (cb != null) {\n      cb(element)\n    }\n  }\n\n  function removeElement(parent, element, data) {\n    if (data && data.onremove) {\n      data.onremove(element)\n    } else {\n      parent.removeChild(element)\n    }\n  }\n\n  function patch(parent, element, oldNode, node, isSVG, lastElement) {\n    if (oldNode == null) {\n      element = parent.insertBefore(createElement(node, isSVG), element)\n    } else if (node.tag != null && node.tag === oldNode.tag) {\n      updateElementData(element, oldNode.data, node.data)\n\n      isSVG = isSVG || node.tag === \"svg\"\n\n      var len = node.children.length\n      var oldLen = oldNode.children.length\n      var reusableChildren = {}\n      var oldElements = []\n      var newKeys = {}\n\n      for (var i = 0; i < oldLen; i++) {\n        var oldElement = element.childNodes[i]\n        oldElements[i] = oldElement\n\n        var oldChild = oldNode.children[i]\n        var oldKey = getKey(oldChild)\n\n        if (null != oldKey) {\n          reusableChildren[oldKey] = [oldElement, oldChild]\n        }\n      }\n\n      var i = 0\n      var j = 0\n\n      while (j < len) {\n        var oldElement = oldElements[i]\n        var oldChild = oldNode.children[i]\n        var newChild = node.children[j]\n\n        var oldKey = getKey(oldChild)\n        if (newKeys[oldKey]) {\n          i++\n          continue\n        }\n\n        var newKey = getKey(newChild)\n\n        var reusableChild = reusableChildren[newKey] || []\n\n        if (null == newKey) {\n          if (null == oldKey) {\n            patch(element, oldElement, oldChild, newChild, isSVG)\n            j++\n          }\n          i++\n        } else {\n          if (oldKey === newKey) {\n            patch(element, reusableChild[0], reusableChild[1], newChild, isSVG)\n            i++\n          } else if (reusableChild[0]) {\n            element.insertBefore(reusableChild[0], oldElement)\n            patch(element, reusableChild[0], reusableChild[1], newChild, isSVG)\n          } else {\n            patch(element, oldElement, null, newChild, isSVG)\n          }\n\n          j++\n          newKeys[newKey] = newChild\n        }\n      }\n\n      while (i < oldLen) {\n        var oldChild = oldNode.children[i]\n        var oldKey = getKey(oldChild)\n        if (null == oldKey) {\n          removeElement(element, oldElements[i], oldChild.data)\n        }\n        i++\n      }\n\n      for (var i in reusableChildren) {\n        var reusableChild = reusableChildren[i]\n        var reusableNode = reusableChild[1]\n        if (!newKeys[reusableNode.data.key]) {\n          removeElement(element, reusableChild[0], reusableNode.data)\n        }\n      }\n    } else if (\n      (lastElement = element) != null &&\n      node !== oldNode &&\n      node !== element.nodeValue\n    ) {\n      parent.replaceChild((element = createElement(node, isSVG)), lastElement)\n    }\n\n    return element\n  }\n}\n"],"names":["tag","data","node","stack","children","i","arguments","length","Array","isArray","pop","app","repaint","locked","requestAnimationFrame","render","hydrate","element","map","tagName","call","childNodes","patch","root","emit","view","state","actions","loaded","initialize","namespace","lastName","Object","keys","key","action","name","result","then","merge","events","cb","a","b","obj","getKey","createElement","isSVG","document","createTextNode","createElementNS","appendChild","setTimeout","setElementData","value","oldValue","style","_","setAttribute","removeAttribute","updateElementData","oldData","onupdate","removeElement","parent","onremove","removeChild","oldNode","lastElement","insertBefore","len","oldLen","reusableChildren","oldElements","newKeys","oldElement","oldKey","oldChild","j","newChild","newKey","reusableChild","reusableNode","nodeValue","replaceChild","mixins","body","mixin","concat","querySelector"],"mappings":"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"}